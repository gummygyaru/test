<!-- Include in <head> -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

<style>
  .site-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1.5rem;
    background: white;
    border-bottom: 1px solid #ddd;
    font-family: 'Segoe UI', Tahoma, sans-serif;
  }

  .header-left h1 {
    font-size: 1.25rem;
    font-weight: 700;
    margin: 0;
    color: #9333ea;
  }

  .header-left .vault {
    color: #3b82f6;
  }

  .header-right {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .icon-link {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 6px;
    transition: background 0.2s;
    color: #444;
    font-size: 1.1rem;
  }

  .icon-link:hover {
    background: #f3f4f6;
    color: #111;
  }

  .notification-icon .notification-count {
    position: absolute;
    top: -4px;
    right: -4px;
    background: #ef4444;
    color: white;
    font-size: 0.65rem;
    font-weight: bold;
    padding: 2px 5px;
    border-radius: 9999px;
    display: none;
  }

  .submit-dropdown {
    position: relative;
  }

  .submit-dropdown:hover .dropdown-menu {
    display: block;
  }

  .dropdown-menu {
    display: none;
    position: absolute;
    right: 0;
    top: 110%;
    background: white;
    border: 1px solid #ddd;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    min-width: 160px;
    z-index: 10;
  }

  .dropdown-menu a {
    display: block;
    padding: 0.5rem 1rem;
    color: #333;
    text-decoration: none;
    font-size: 0.875rem;
  }

  .dropdown-menu a:hover {
    background: #f0f0f5;
  }
</style>

<header class="site-header">
  <div class="header-left">
    <h1>chara.<span class="vault">vault</span></h1>
  </div>
  <div class="header-right">
    <a href="profile.html" title="Profile" class="icon-link">
      <i class="fas fa-user-circle"></i>
    </a>
    <a href="dashboard.html" title="Settings" class="icon-link">
      <i class="fas fa-cog"></i>
    </a>
    <a href="notifications.html" title="Notifications" class="icon-link notification-icon">
      <i class="fas fa-bell"></i>
      <span class="notification-count" id="notifCount">0</span>
    </a>
    <div class="icon-link submit-dropdown" title="Upload">
      <i class="fas fa-plus-circle"></i>
      <div class="dropdown-menu">
        <a href="dashboard/upload-art.html">Upload Art</a>
        <a href="dashboard/upload-character.html">Upload Character</a>
        <a href="dashboard/upload-world.html">Upload World</a>
        <a href="dashboard/upload-story.html">Upload Story</a>
      </div>
    </div>
  </div>
</header>

<!-- Firebase Notification Script -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getFirestore, collection, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDDZvaWl5qwJbvPOHN1pisGwfIN2gkj1Ec",
    authDomain: "charavault-e8cf5.firebaseapp.com",
    projectId: "charavault-e8cf5",
    storageBucket: "charavault-e8cf5.appspot.com",
    messagingSenderId: "385710051091",
    appId: "1:385710051091:web:a38d5ac0047ec32a0914e6",
    measurementId: "G-JNLB26DXJC"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const notifCount = document.getElementById("notifCount");

  onAuthStateChanged(auth, (user) => {
    if (user) {
      const notifRef = collection(db, "notifications");
      const q = query(
        notifRef,
        where("userId", "==", user.uid),
        where("read", "==", false)
      );

      onSnapshot(q, (querySnapshot) => {
        const unreadCount = querySnapshot.size;
        if (unreadCount > 0) {
          notifCount.textContent = unreadCount;
          notifCount.style.display = "inline-block";
        } else {
          notifCount.style.display = "none";
        }
      });
    } else {
      notifCount.style.display = "none";
    }
  });
</script>

